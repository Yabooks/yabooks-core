<!DOCTYPE HTML>
<html>
    <head>
        <title>YaBooks</title>
        <base target="main" />
        <link rel="stylesheet" type="text/css" href="style.css" />
        <script type="text/javascript" src="/js/axios/axios.min.js"></script>
        <script type="text/javascript" src="/js/vue/vue.js"></script>
    </head>
    <body>
        <main>
            <nav>
                <a href="/login/">
                    Home
                </a>
                <a @click="logout">
                    Logout
                </a>
            </nav>
            <iframe id="main" name="main" src="/login/"></iframe>
            <div id="shadow" v-if="modal">
                <iframe id="modal" name="modal" :src="modal"></iframe>
                <button id="close" @click="openModal(false)" alt="close">&#10006;</button>
            </iframe>
        </main>
        <script type="text/javascript">
            new Vue(
            {
                el: "main",

                data:
                {
                    modal: false
                },

                async mounted()
                {
                    document.addEventListener("keyup", (event) =>
                    {
                        if((event.ctrlKey || event.metaKey) && (event.key == 'i' || event.key == 'I'))
                            this.openModal("/quick-recorder/");

                        if(this.modal && event.key == "Escape")
                            this.openModal(false);
                    }, true);

                    const notifier = new WebSocket(location.protocol.split("http").join("ws") + "//" + location.host + "/api/v1/notifications/ws");
                    notifier.onmessage = async (event) => {
                        console.log(event); // FIXME
                    };
                },

                methods:
                {
                    openModal(url)
                    {
                        this.modal = url;
                    },

                    async logout()
                    {
                        await axios.delete("/api/v1/session");
                        self.location = "/";
                    }
                }
            });
        </script>
    </body>
</html>
